sudo: false

language: c

compiler:
  - gcc

git:
  submodules: false

env:
  matrix:
    - TRAVIS_EMPTY_JOB_WORKAROUND=true

matrix:
  exclude:
    - env: TRAVIS_EMPTY_JOB_WORKAROUND=true
  include:
    - env: STATUS_TESTS=true
    - env: RELEASE_BUILD=LF
    - env: RELEASE_BUILD=CRLF

before_install:
  - |
    if [[ "${STATUS_TESTS}" == "true" ]]; then
      git submodule update --init --recursive
    fi
  - |
    if [[ "${RELEASE_BUILD}" == "LF" ]]; then
      git config core.eol lf
      git config core.autocrlf false
      git rm --cache -r .
      git reset --hard HEAD
      git submodule update --init --recursive
    fi
  - |
    if [[ "${RELEASE_BUILD}" == "CRLF" ]]; then
      git config core.eol crlf
      git config core.autocrlf false
      git rm --cache -r .
      git reset --hard HEAD
      git submodule update --init --recursive
    fi

script:
  - |
    if [[ "${STATUS_TESTS}" == "true" ]]; then
      ./bootstrap.sh
      ./b2 -n
      cd status
      ../b2 -n -d0
    fi
  - |
    if [[ "${RELEASE_BUILD}" == "LF" || "${RELEASE_BUILD}" == "CRLF" ]]; then
      cd "${TRAVIS_BUILD_DIR}/.."
      wget "https://raw.githubusercontent.com/boostorg/release-tools/develop/MakeBoostDistro.py"
      chmod +x MakeBoostDistro.py
      export BOOST_RELEASE=boost_${TRAVIS_BRANCH}_${TRAVIS_COMMIT}
      ./MakeBoostDistro.py "${TRAVIS_BUILD_DIR}" "${BOOST_RELEASE}"
    fi
  - |
    if [[ "${RELEASE_BUILD}" == "LF" ]]; then
      cd "${TRAVIS_BUILD_DIR}/.."
      gnutar -zcf "${BOOST_RELEASE}.tar.gz" "${BOOST_RELEASE}"
      gnutar -cjf "${BOOST_RELEASE}.tar.bz2" "${BOOST_RELEASE}"
    fi
